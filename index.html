<!DOCTYPE html>
<html lang="pl">
  <head>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <meta name="theme-color" content="#667eea" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transport Na ≈ªƒÖdanie</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px 20px;
        position: relative;
      }

      .header h1 {
        font-size: 24px;
        margin-bottom: 5px;
      }

      .header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .settings-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .settings-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
      }

      .schedule-toggle {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 10px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
      }

      .schedule-toggle:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .schedule-toggle.active {
        background: rgba(255, 255, 255, 0.9);
        color: #667eea;
        font-weight: 600;
      }

      .back-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .content {
        padding: 20px;
        max-height: calc(100vh - 250px);
        overflow-y: auto;
      }

      .departure-item.break-time {
        border-color: #fbbf24;
        background: #fffbeb;
        opacity: 0.7;
        cursor: not-allowed;
      }

      .departure-item.break-time:hover {
        border-color: #fbbf24;
        box-shadow: none;
        transform: none;
      }

      .departure-item.break-time .time-icon {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      }

      .departure-item.break-time .time-text {
        color: #92400e;
      }

      .departure-item {
        width: 100%;
        margin-bottom: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        background: white;
        overflow: hidden;
        transition: all 0.2s;
      }

      .departure-item:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
      }

      .departure-main {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        cursor: pointer;
      }

      .departure-time {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .time-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .time-text {
        font-size: 22px;
        font-weight: bold;
        color: #333;
      }

      .badge {
        background: #4ade80;
        color: white;
        padding: 4px 7px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 600;
      }

      .departure-buttons {
        display: flex;
        gap: 10px;
        padding: 0 20px 15px 20px;
        border-top: 1px solid #f0f0f0;
        padding-top: 15px;
      }

      .departure-btn-small {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-small {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
      }

      .copy-small:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
      }

      .copy-small.copied {
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      }

      .clear-small {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
      }

      .clear-small:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
      }

      .stop-btn {
        width: 100%;
        padding: 15px;
        margin-bottom: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        background: white;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.2s;
      }

      .stop-btn.selected {
        background: #f0f4ff;
        border-color: #667eea;
      }

      .stop-left {
        display: flex;
        align-items: center;
      }

      .checkbox {
        width: 24px;
        height: 24px;
        border: 2px solid #ddd;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.2s;
      }

      .stop-btn.selected .checkbox {
        background: #667eea;
        border-color: #667eea;
        color: white;
      }

      .stop-name {
        text-align: left;
        margin-left: 15px;
        font-size: 16px;
        color: #333;
      }

      .stop-btn.selected .stop-name {
        font-weight: 600;
        color: #667eea;
      }

      .stop-time {
        font-size: 14px;
        color: #667eea;
        font-weight: 600;
        padding: 4px 8px;
        background: #f0f4ff;
        border-radius: 8px;
      }

      .action-buttons {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .btn {
        width: 100%;
        padding: 18px;
        color: white;
        border: none;
        border-radius: 15px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-sms {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
      }

      .btn-sms:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(139, 92, 246, 0.4);
      }

      .btn-save {
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        box-shadow: 0 10px 20px rgba(34, 197, 94, 0.3);
      }

      .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(34, 197, 94, 0.4);
      }

      .btn-copy {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
      }

      .btn-copy:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(37, 99, 235, 0.4);
      }

      .btn-copy.copied {
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      }

      .btn-clear {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
      }

      .btn-clear:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(239, 68, 68, 0.4);
      }

      .settings-form {
        padding: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }

      .form-group input {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.2s;
      }

      .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .phone-info {
        background: #f0f4ff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
      }

      .phone-info p {
        margin: 5px 0;
        color: #555;
        font-size: 14px;
      }

      .phone-info strong {
        color: #667eea;
        font-size: 18px;
      }

      .time-sub {
        font-size: 12px;
        color: #666;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Widok listy odjazd√≥w -->
      <div id="departures-view">
        <div class="header">
          <button class="settings-btn" onclick="showSettings()">‚öôÔ∏è</button>
          <h1>üöå Odjazdy Autobusu</h1>
          <p>Wybierz godzinƒô odjazdu</p>
          <div style="margin-top: 15px">
            <button
              class="schedule-toggle"
              id="school-toggle"
              onclick="toggleScheduleType('school')"
            >
              üìö Dni szkolne
            </button>
            <button
              class="schedule-toggle active"
              id="vacation-toggle"
              onclick="toggleScheduleType('vacation')"
            >
              üèñÔ∏è Dni wolne
            </button>
          </div>
        </div>
        <div class="content" id="departures-list"></div>
      </div>

      <!-- Widok przystank√≥w -->
      <div id="stops-view" class="hidden">
        <div class="header">
          <button class="back-btn" onclick="showDepartures()">‚Üê Powr√≥t</button>
          <h1 id="selected-time">Kurs</h1>
          <p id="stops-counter">Zaznacz przystanki</p>
        </div>
        <div class="content" id="stops-list"></div>
        <div class="action-buttons">
          <button class="btn btn-sms" onclick="sendSMS()">üì± Wy≈õlij SMS</button>
          <button
            class="btn btn-copy"
            id="copy-btn-stops"
            onclick="copyToClipboard()"
          >
            üìã Skopiuj listƒô
          </button>
          <button class="btn btn-clear" onclick="clearCurrentStops()">
            üóëÔ∏è Wyczy≈õƒá przystanki
          </button>
          <button class="btn btn-save" onclick="saveStops()">üíæ Zapisz</button>
        </div>
      </div>

      <!-- Widok ustawie≈Ñ -->
      <div id="settings-view" class="hidden">
        <div class="header">
          <button class="back-btn" onclick="showDepartures()">‚Üê Powr√≥t</button>
          <h1>‚öôÔ∏è Ustawienia</h1>
          <p>Skonfiguruj aplikacjƒô</p>
        </div>
        <div class="settings-form">
          <div class="phone-info">
            <p>Aktualny numer telefonu:</p>
            <p><strong id="current-phone-display">572138563</strong></p>
          </div>

          <div class="form-group">
            <label for="phone-input">Numer telefonu kierowcy:</label>
            <input
              type="tel"
              id="phone-input"
              placeholder="np. 502111222"
              maxlength="15"
            />
          </div>

          <div class="action-buttons">
            <button class="btn btn-save" onclick="savePhoneNumber()">
              üíæ Zapisz numer
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Formatowanie nazwy przystanku
      function formatDepartureLabel(label) {
        const open = label.indexOf("(");
        if (open === -1) return label; // bez zmian je≈õli brak nawias√≥w

        const time = label.substring(0, open).trim();
        const subtitle = label.substring(open).replace(/[()]/g, "").trim();

        return `${time}<br><span class="time-sub">${subtitle}</span>`;
      }

      // Domy≈õlny numer telefonu
      const DEFAULT_PHONE = "572138563";

      // Typ rozk≈Çadu: 'school' lub 'vacation'
      let scheduleType = "vacation";

      // Przystanki
      const busStops = [
        "SKM Podjuchy",
        "Skalista",
        "Metalowa",
        "Szlamowa",
        "Granitowa",
        "Zamieƒá",
        "Ostowa",
        "Lechicka",
        "Chojnicka",
        "Mielecka",
        "SƒÖsiedzka",
        "Chromowa",
        "Ruda",
        "Wschodnia",
        "Grzegorzewskiej",
        "Che≈Çmi≈Ñska",
        "Miechowska",
      ];

      // ROZK≈ÅAD JAZDY - DNI SZKOLNE

      const scheduleSchool = {
        "06:27 (kurs dojazdowy)": {
          SƒÖsiedzka: "06:27",

          Chromowa: "06:28",

          Ruda: "06:29",

          Wschodnia: "06:30",

          Grzegorzewskiej: "06:31",

          Che≈Çmi≈Ñska: "06:33",

          Miechowska: "06:34",
        },

        "06:40 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "06:40",

          Metalowa: "06:42",

          Szlamowa: "06:43",

          Granitowa: "06:45",

          Zamieƒá: "06:48",

          Ostowa: "06:53",

          Lechicka: "06:53",

          Chojnicka: "06:55",

          Mielecka: "06:56",

          SƒÖsiedzka: "06:57",

          Chromowa: "06:58",

          Ruda: "06:59",

          Wschodnia: "07:00",

          Grzegorzewskiej: "07:01",

          Che≈Çmi≈Ñska: "07:03",

          Miechowska: "07:04",
        },

        "07:10": {
          "SKM Podjuchy": "07:10",

          Metalowa: "07:12",

          Szlamowa: "07:13",

          Granitowa: "07:15",

          Ostowa: "07:17",

          Lechicka: "07:17",

          Chojnicka: "07:19",

          Mielecka: "07:20",

          SƒÖsiedzka: "07:21",

          Chromowa: "07:22",

          Ruda: "07:23",

          Wschodnia: "07:24",

          Grzegorzewskiej: "07:25",

          Che≈Çmi≈Ñska: "07:27",

          Miechowska: "07:28",
        },

        "07:40 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "07:40",

          Skalista: "07:42",

          Szlamowa: "07:47",

          Granitowa: "07:49",

          Ostowa: "07:51",

          Lechicka: "07:51",

          Chojnicka: "07:53",

          Mielecka: "07:54",

          SƒÖsiedzka: "07:55",

          Chromowa: "07:56",

          Ruda: "07:57",

          Wschodnia: "07:58",

          Grzegorzewskiej: "07:59",

          Che≈Çmi≈Ñska: "08:01",

          Miechowska: "08:02",
        },

        "08:10 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "08:10",

          Metalowa: "08:12",

          Szlamowa: "08:13",

          Granitowa: "08:15",

          Zamieƒá: "08:18",

          Ostowa: "08:23",

          Lechicka: "08:23",

          Chojnicka: "08:25",

          Mielecka: "08:26",

          SƒÖsiedzka: "08:27",

          Chromowa: "08:28",

          Ruda: "08:29",

          Wschodnia: "08:30",

          Grzegorzewskiej: "08:31",

          Che≈Çmi≈Ñska: "08:33",

          Miechowska: "08:34",
        },

        "08:40 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "08:40",

          Skalista: "08:42",

          Szlamowa: "08:47",

          Granitowa: "08:49",

          Ostowa: "08:51",

          Lechicka: "08:51",

          Chojnicka: "08:53",

          Mielecka: "08:54",

          SƒÖsiedzka: "08:55",

          Chromowa: "08:56",

          Ruda: "08:57",

          Wschodnia: "08:58",

          Grzegorzewskiej: "08:59",

          Che≈Çmi≈Ñska: "09:01",

          Miechowska: "09:02",
        },

        "09:10": {
          "SKM Podjuchy": "09:10",

          Metalowa: "09:12",

          Szlamowa: "09:13",

          Granitowa: "09:15",

          Ostowa: "09:17",

          Lechicka: "09:17",

          Chojnicka: "09:19",

          Mielecka: "09:20",

          SƒÖsiedzka: "09:21",

          Chromowa: "09:22",

          Ruda: "09:23",

          Wschodnia: "09:24",

          Grzegorzewskiej: "09:25",

          Che≈Çmi≈Ñska: "09:27",

          Miechowska: "09:28",
        },

        "09:33 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "09:33",

          Skalista: "09:35",

          Szlamowa: "09:40",

          Granitowa: "09:42",

          Ostowa: "09:44",

          Lechicka: "09:44",

          Chojnicka: "09:46",

          Mielecka: "09:47",

          SƒÖsiedzka: "09:48",

          Chromowa: "09:49",

          Ruda: "09:50",

          Wschodnia: "09:51",

          Grzegorzewskiej: "09:52",

          Che≈Çmi≈Ñska: "09:54",

          Miechowska: "09:55",
        },

        "10:00": {
          "SKM Podjuchy": "10:00",

          Metalowa: "10:02",

          Szlamowa: "10:03",

          Granitowa: "10:05",

          Ostowa: "10:07",

          Lechicka: "10:07",

          Chojnicka: "10:09",

          Mielecka: "10:10",

          SƒÖsiedzka: "10:11",

          Chromowa: "10:12",

          Ruda: "10:13",

          Wschodnia: "10:14",

          Grzegorzewskiej: "10:15",

          Che≈Çmi≈Ñska: "10:17",

          Miechowska: "10:18",
        },

        "10:30": {
          "SKM Podjuchy": "10:30",

          Metalowa: "10:32",

          Szlamowa: "10:33",

          Granitowa: "10:35",

          Ostowa: "10:37",

          Lechicka: "10:37",

          Chojnicka: "10:39",

          Mielecka: "10:40",

          SƒÖsiedzka: "10:41",

          Chromowa: "10:42",

          Ruda: "10:43",

          Wschodnia: "10:44",

          Grzegorzewskiej: "10:45",

          Che≈Çmi≈Ñska: "10:47",

          Miechowska: "10:48",
        },

        "11:00": {
          "SKM Podjuchy": "11:00",

          Metalowa: "11:02",

          Szlamowa: "11:03",

          Granitowa: "11:05",

          Ostowa: "11:07",

          Lechicka: "11:07",

          Chojnicka: "11:09",

          Mielecka: "11:10",

          SƒÖsiedzka: "11:11",

          Chromowa: "11:12",

          Ruda: "11:13",

          Wschodnia: "11:14",

          Grzegorzewskiej: "11:15",

          Che≈Çmi≈Ñska: "11:17",

          Miechowska: "11:18",
        },

        "12:15": {
          "SKM Podjuchy": "12:15",

          Metalowa: "12:17",

          Szlamowa: "12:18",

          Granitowa: "12:20",

          Ostowa: "12:22",

          Lechicka: "12:22",

          Chojnicka: "12:24",

          Mielecka: "12:25",

          SƒÖsiedzka: "12:26",

          Chromowa: "12:27",

          Ruda: "12:28",

          Wschodnia: "12:29",

          Grzegorzewskiej: "12:30",

          Che≈Çmi≈Ñska: "12:32",

          Miechowska: "12:33",
        },

        "12:45 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "12:45",

          Skalista: "12:47",

          Szlamowa: "12:52",

          Granitowa: "12:54",

          Ostowa: "12:56",

          Lechicka: "12:56",

          Chojnicka: "12:58",

          Mielecka: "12:59",

          SƒÖsiedzka: "13:00",

          Chromowa: "13:01",

          Ruda: "13:02",

          Wschodnia: "13:03",

          Grzegorzewskiej: "13:04",

          Che≈Çmi≈Ñska: "13:06",

          Miechowska: "13:07",
        },

        "13:15": {
          "SKM Podjuchy": "13:15",

          Metalowa: "13:17",

          Szlamowa: "13:18",

          Granitowa: "13:20",

          Ostowa: "13:22",

          Lechicka: "13:22",

          Chojnicka: "13:24",

          Mielecka: "13:25",

          SƒÖsiedzka: "13:26",

          Chromowa: "13:27",

          Ruda: "13:28",

          Wschodnia: "13:29",

          Grzegorzewskiej: "13:30",

          Che≈Çmi≈Ñska: "13:32",

          Miechowska: "13:33",
        },

        "13:45 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "13:45",

          Skalista: "13:47",

          Szlamowa: "13:52",

          Granitowa: "13:54",

          Ostowa: "13:56",

          Lechicka: "13:56",

          Chojnicka: "13:58",

          Mielecka: "13:59",

          SƒÖsiedzka: "14:00",

          Chromowa: "14:01",

          Ruda: "14:02",

          Wschodnia: "14:03",

          Grzegorzewskiej: "14:04",

          Che≈Çmi≈Ñska: "14:06",

          Miechowska: "14:07",
        },

        "14:15 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "14:15",

          Metalowa: "14:17",

          Szlamowa: "14:18",

          Granitowa: "14:20",

          Zamieƒá: "14:23",

          Ostowa: "14:28",

          Lechicka: "14:28",

          Chojnicka: "14:30",

          Mielecka: "14:31",

          SƒÖsiedzka: "14:32",

          Chromowa: "14:33",

          Ruda: "14:34",

          Wschodnia: "14:35",

          Grzegorzewskiej: "14:36",

          Che≈Çmi≈Ñska: "14:38",

          Miechowska: "14:39",
        },

        "14:45 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "14:45",

          Skalista: "14:47",

          Szlamowa: "14:52",

          Granitowa: "14:54",

          Ostowa: "14:56",

          Lechicka: "14:56",

          Chojnicka: "14:58",

          Mielecka: "14:59",

          SƒÖsiedzka: "15:00",

          Chromowa: "15:01",

          Ruda: "15:02",

          Wschodnia: "15:03",

          Grzegorzewskiej: "15:04",

          Che≈Çmi≈Ñska: "15:06",

          Miechowska: "15:07",
        },

        "15:15 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "14:15",

          Metalowa: "15:17",

          Szlamowa: "15:18",

          Granitowa: "15:20",

          Zamieƒá: "15:23",

          Ostowa: "15:28",

          Lechicka: "15:28",

          Chojnicka: "15:30",

          Mielecka: "15:31",

          SƒÖsiedzka: "15:32",

          Chromowa: "15:33",

          Ruda: "15:34",

          Wschodnia: "15:35",

          Grzegorzewskiej: "15:36",

          Che≈Çmi≈Ñska: "15:38",

          Miechowska: "15:39",
        },

        "15:45 (kurs przez ul. SkalistƒÖ)": {
          "SKM Podjuchy": "15:45",

          Skalista: "15:47",

          Szlamowa: "15:52",

          Granitowa: "15:54",

          Ostowa: "15:56",

          Lechicka: "15:56",

          Chojnicka: "15:58",

          Mielecka: "15:59",

          SƒÖsiedzka: "16:00",

          Chromowa: "16:01",

          Ruda: "16:02",

          Wschodnia: "16:03",

          Grzegorzewskiej: "16:04",

          Che≈Çmi≈Ñska: "16:06",

          Miechowska: "16:07",
        },

        "16:15": {
          "SKM Podjuchy": "16:15",

          Metalowa: "16:17",

          Szlamowa: "16:18",

          Granitowa: "16:20",

          Ostowa: "16:22",

          Lechicka: "16:22",

          Chojnicka: "16:24",

          Mielecka: "16:25",

          SƒÖsiedzka: "16:26",

          Chromowa: "16:27",

          Ruda: "16:28",

          Wschodnia: "16:29",

          Grzegorzewskiej: "16:30",

          Che≈Çmi≈Ñska: "16:32",

          Miechowska: "16:33",
        },
      };
      // ROZK≈ÅAD JAZDY - DNI WOLNE OD NAUKI

      const scheduleVacation = {
        "06:27 (kurs dojazdowy)": {
          SƒÖsiedzka: "06:27",

          Chromowa: "06:28",

          Ruda: "06:29",

          Wschodnia: "06:30",

          Grzegorzewskiej: "06:31",

          Che≈Çmi≈Ñska: "06:33",

          Miechowska: "06:34",
        },

        "06:40 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "06:40",

          Metalowa: "06:42",

          Szlamowa: "06:43",

          Granitowa: "06:45",

          Zamieƒá: "06:48",

          Ostowa: "06:53",

          Lechicka: "06:53",

          Chojnicka: "06:55",

          Mielecka: "06:56",

          SƒÖsiedzka: "06:57",

          Chromowa: "06:58",

          Ruda: "06:59",

          Wschodnia: "07:00",

          Grzegorzewskiej: "07:01",

          Che≈Çmi≈Ñska: "07:03",

          Miechowska: "07:04",
        },

        "07:10": {
          "SKM Podjuchy": "07:10",

          Metalowa: "07:12",

          Szlamowa: "07:13",

          Granitowa: "07:15",

          Ostowa: "07:17",

          Lechicka: "07:17",

          Chojnicka: "07:19",

          Mielecka: "07:20",

          SƒÖsiedzka: "07:21",

          Chromowa: "07:22",

          Ruda: "07:23",

          Wschodnia: "07:24",

          Grzegorzewskiej: "07:25",

          Che≈Çmi≈Ñska: "07:27",

          Miechowska: "07:28",
        },

        "07:40": {
          "SKM Podjuchy": "07:40",

          Metalowa: "07:42",

          Szlamowa: "07:43",

          Granitowa: "07:45",

          Ostowa: "07:47",

          Lechicka: "07:47",

          Chojnicka: "07:49",

          Mielecka: "07:50",

          SƒÖsiedzka: "07:51",

          Chromowa: "07:52",

          Ruda: "07:53",

          Wschodnia: "07:54",

          Grzegorzewskiej: "07:55",

          Che≈Çmi≈Ñska: "07:57",

          Miechowska: "07:58",
        },

        "08:10 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "08:10",

          Metalowa: "08:12",

          Szlamowa: "08:13",

          Granitowa: "08:15",

          Zamieƒá: "08:18",

          Ostowa: "08:23",

          Lechicka: "08:23",

          Chojnicka: "08:25",

          Mielecka: "08:26",

          SƒÖsiedzka: "08:27",

          Chromowa: "08:28",

          Ruda: "08:29",

          Wschodnia: "08:30",

          Grzegorzewskiej: "08:31",

          Che≈Çmi≈Ñska: "08:33",

          Miechowska: "08:34",
        },

        "08:40": {
          "SKM Podjuchy": "08:40",

          Metalowa: "08:42",

          Szlamowa: "08:43",

          Granitowa: "08:45",

          Ostowa: "08:47",

          Lechicka: "08:47",

          Chojnicka: "08:49",

          Mielecka: "08:50",

          SƒÖsiedzka: "08:51",

          Chromowa: "08:52",

          Ruda: "08:53",

          Wschodnia: "08:54",

          Grzegorzewskiej: "08:55",

          Che≈Çmi≈Ñska: "08:57",

          Miechowska: "08:58",
        },

        "09:10": {
          "SKM Podjuchy": "09:10",

          Metalowa: "09:12",

          Szlamowa: "09:13",

          Granitowa: "09:15",

          Ostowa: "09:17",

          Lechicka: "09:17",

          Chojnicka: "09:19",

          Mielecka: "09:20",

          SƒÖsiedzka: "09:21",

          Chromowa: "09:22",

          Ruda: "09:23",

          Wschodnia: "09:24",

          Grzegorzewskiej: "09:25",

          Che≈Çmi≈Ñska: "09:27",

          Miechowska: "09:28",
        },

        "09:35": {
          "SKM Podjuchy": "09:35",

          Metalowa: "09:37",

          Szlamowa: "09:38",

          Granitowa: "09:40",

          Ostowa: "09:42",

          Lechicka: "09:42",

          Chojnicka: "09:44",

          Mielecka: "09:45",

          SƒÖsiedzka: "09:46",

          Chromowa: "09:47",

          Ruda: "09:48",

          Wschodnia: "09:49",

          Grzegorzewskiej: "09:50",

          Che≈Çmi≈Ñska: "09:52",

          Miechowska: "09:53",
        },

        "10:00": {
          "SKM Podjuchy": "10:00",

          Metalowa: "10:02",

          Szlamowa: "10:03",

          Granitowa: "10:05",

          Ostowa: "10:07",

          Lechicka: "10:07",

          Chojnicka: "10:09",

          Mielecka: "10:10",

          SƒÖsiedzka: "10:11",

          Chromowa: "10:12",

          Ruda: "10:13",

          Wschodnia: "10:14",

          Grzegorzewskiej: "10:15",

          Che≈Çmi≈Ñska: "10:17",

          Miechowska: "10:18",
        },

        "10:30": {
          "SKM Podjuchy": "10:30",

          Metalowa: "10:32",

          Szlamowa: "10:33",

          Granitowa: "10:35",

          Ostowa: "10:37",

          Lechicka: "10:37",

          Chojnicka: "10:39",

          Mielecka: "10:40",

          SƒÖsiedzka: "10:41",

          Chromowa: "10:42",

          Ruda: "10:43",

          Wschodnia: "10:44",

          Grzegorzewskiej: "10:45",

          Che≈Çmi≈Ñska: "10:47",

          Miechowska: "10:48",
        },

        "11:00": {
          "SKM Podjuchy": "11:00",

          Metalowa: "11:02",

          Szlamowa: "11:03",

          Granitowa: "11:05",

          Ostowa: "11:07",

          Lechicka: "11:07",

          Chojnicka: "11:09",

          Mielecka: "11:10",

          SƒÖsiedzka: "11:11",

          Chromowa: "11:12",

          Ruda: "11:13",

          Wschodnia: "11:14",

          Grzegorzewskiej: "11:15",

          Che≈Çmi≈Ñska: "11:17",

          Miechowska: "11:18",
        },

        "12:15": {
          "SKM Podjuchy": "12:15",

          Metalowa: "12:17",

          Szlamowa: "12:18",

          Granitowa: "12:20",

          Ostowa: "12:22",

          Lechicka: "12:22",

          Chojnicka: "12:24",

          Mielecka: "12:25",

          SƒÖsiedzka: "12:26",

          Chromowa: "12:27",

          Ruda: "12:28",

          Wschodnia: "12:29",

          Grzegorzewskiej: "12:30",

          Che≈Çmi≈Ñska: "12:32",

          Miechowska: "12:33",
        },

        "12:45": {
          "SKM Podjuchy": "12:45",

          Metalowa: "12:47",

          Szlamowa: "12:48",

          Granitowa: "12:50",

          Ostowa: "12:52",

          Lechicka: "12:52",

          Chojnicka: "12:54",

          Mielecka: "12:55",

          SƒÖsiedzka: "12:56",

          Chromowa: "12:57",

          Ruda: "12:58",

          Wschodnia: "12:59",

          Grzegorzewskiej: "13:00",

          Che≈Çmi≈Ñska: "13:02",

          Miechowska: "13:03",
        },

        "13:15": {
          "SKM Podjuchy": "13:15",

          Metalowa: "13:17",

          Szlamowa: "13:18",

          Granitowa: "13:20",

          Ostowa: "13:22",

          Lechicka: "13:22",

          Chojnicka: "13:24",

          Mielecka: "13:25",

          SƒÖsiedzka: "13:26",

          Chromowa: "13:27",

          Ruda: "13:28",

          Wschodnia: "13:29",

          Grzegorzewskiej: "13:30",

          Che≈Çmi≈Ñska: "13:32",

          Miechowska: "13:33",
        },

        "13:45": {
          "SKM Podjuchy": "13:45",

          Metalowa: "13:47",

          Szlamowa: "13:48",

          Granitowa: "13:50",

          Ostowa: "13:52",

          Lechicka: "13:52",

          Chojnicka: "13:54",

          Mielecka: "13:55",

          SƒÖsiedzka: "13:56",

          Chromowa: "13:57",

          Ruda: "13:58",

          Wschodnia: "13:59",

          Grzegorzewskiej: "14:00",

          Che≈Çmi≈Ñska: "14:02",

          Miechowska: "14:03",
        },

        "14:15 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "14:15",

          Metalowa: "14:17",

          Szlamowa: "14:18",

          Granitowa: "14:20",

          Zamieƒá: "14:23",

          Ostowa: "14:28",

          Lechicka: "14:28",

          Chojnicka: "14:30",

          Mielecka: "14:31",

          SƒÖsiedzka: "14:32",

          Chromowa: "14:33",

          Ruda: "14:34",

          Wschodnia: "14:35",

          Grzegorzewskiej: "14:36",

          Che≈Çmi≈Ñska: "14:38",

          Miechowska: "14:39",
        },

        "14:45": {
          "SKM Podjuchy": "14:45",

          Metalowa: "14:47",

          Szlamowa: "14:48",

          Granitowa: "14:50",

          Ostowa: "14:52",

          Lechicka: "14:52",

          Chojnicka: "14:54",

          Mielecka: "14:55",

          SƒÖsiedzka: "14:56",

          Chromowa: "14:57",

          Ruda: "14:58",

          Wschodnia: "14:59",

          Grzegorzewskiej: "15:00",

          Che≈Çmi≈Ñska: "15:02",

          Miechowska: "15:03",
        },

        "15:15 (kurs przez ul. Zamieƒá)": {
          "SKM Podjuchy": "14:15",

          Metalowa: "15:17",

          Szlamowa: "15:18",

          Granitowa: "15:20",

          Zamieƒá: "15:23",

          Ostowa: "15:28",

          Lechicka: "15:28",

          Chojnicka: "15:30",

          Mielecka: "15:31",

          SƒÖsiedzka: "15:32",

          Chromowa: "15:33",

          Ruda: "15:34",

          Wschodnia: "15:35",

          Grzegorzewskiej: "15:36",

          Che≈Çmi≈Ñska: "15:38",

          Miechowska: "15:39",
        },

        "15:45": {
          "SKM Podjuchy": "15:45",

          Metalowa: "15:47",

          Szlamowa: "15:48",

          Granitowa: "15:50",

          Ostowa: "15:52",

          Lechicka: "15:52",

          Chojnicka: "15:54",

          Mielecka: "15:55",

          SƒÖsiedzka: "15:56",

          Chromowa: "15:57",

          Ruda: "15:58",

          Wschodnia: "15:59",

          Grzegorzewskiej: "16:00",

          Che≈Çmi≈Ñska: "16:02",

          Miechowska: "16:03",
        },

        "16:15": {
          "SKM Podjuchy": "16:15",

          Metalowa: "16:17",

          Szlamowa: "16:18",

          Granitowa: "16:20",

          Ostowa: "16:22",

          Lechicka: "16:22",

          Chojnicka: "16:24",

          Mielecka: "16:25",

          SƒÖsiedzka: "16:26",

          Chromowa: "16:27",

          Ruda: "16:28",

          Wschodnia: "16:29",

          Grzegorzewskiej: "16:30",

          Che≈Çmi≈Ñska: "16:32",

          Miechowska: "16:33",
        },
      };

      // Stan aplikacji
      let currentDeparture = null;
      let selectedStops = {};
      let savedSchedules = {};
      let driverPhone = DEFAULT_PHONE;

      // Prze≈ÇƒÖcz typ rozk≈Çadu
      function toggleScheduleType(type) {
        scheduleType = type;

        // Aktualizuj wyglƒÖd przycisk√≥w
        document.getElementById("school-toggle").classList.remove("active");
        document.getElementById("vacation-toggle").classList.remove("active");

        if (type === "school") {
          document.getElementById("school-toggle").classList.add("active");
        } else {
          document.getElementById("vacation-toggle").classList.add("active");
        }

        // Od≈õwie≈º listƒô odjazd√≥w
        renderDepartures();
      }

      // Pobierz aktualny rozk≈Çad
      function getCurrentSchedule() {
        return scheduleType === "school" ? scheduleSchool : scheduleVacation;
      }

      // Wczytaj zapisane dane
      function loadData() {
        const saved = localStorage.getItem("busSchedules");
        if (saved) {
          savedSchedules = JSON.parse(saved);
        }

        const savedPhone = localStorage.getItem("driverPhone");
        if (savedPhone) {
          driverPhone = savedPhone;
        }

        updatePhoneDisplay();
      }

      // Aktualizuj wy≈õwietlany numer
      function updatePhoneDisplay() {
        document.getElementById("current-phone-display").textContent =
          driverPhone;
        document.getElementById("phone-input").value = driverPhone;
      }

      // Poka≈º ustawienia
      function showSettings() {
        document.getElementById("departures-view").classList.add("hidden");
        document.getElementById("stops-view").classList.add("hidden");
        document.getElementById("settings-view").classList.remove("hidden");
        updatePhoneDisplay();
      }

      // Zapisz numer telefonu
      function savePhoneNumber() {
        const input = document.getElementById("phone-input").value.trim();

        if (!input) {
          alert("Proszƒô wpisaƒá numer telefonu!");
          return;
        }

        const cleanPhone = input.replace(/[^\d+]/g, "");

        if (cleanPhone.length < 9) {
          alert("Numer telefonu jest za kr√≥tki!");
          return;
        }

        driverPhone = cleanPhone;
        localStorage.setItem("driverPhone", driverPhone);
        updatePhoneDisplay();

        alert(`‚úÖ Numer zapisany: ${driverPhone}`);
        showDepartures();
      }

      // Generuj odjazdy na podstawie aktywnego rozk≈Çadu
      function generateDepartures() {
        const schedule = getCurrentSchedule();
        return Object.keys(schedule);
      }

      // Wy≈õwietl listƒô odjazd√≥w
      function renderDepartures() {
        const list = document.getElementById("departures-list");
        const departures = generateDepartures();

        list.innerHTML = departures
          .map((time) => {
            const count = getSelectedCount(time);
            const hasSavedStops = count > 0;

            const badge = hasSavedStops
              ? `<span class="badge">‚úì ${count} ${
                  count === 1 ? "przystanek" : "przystanki"
                }</span>`
              : "";

            const buttons = hasSavedStops
              ? `
                                  <div class="departure-buttons">
                                      <button class="departure-btn-small copy-small" onclick="copyDepartureList(event, '${time}')">üìã Skopiuj</button>
                                      <button class="departure-btn-small clear-small" onclick="clearDeparture(event, '${time}')">üóëÔ∏è Wyczy≈õƒá</button>
                                  </div>
                              `
              : "";

            return `
                                  <div class="departure-item">
                                      <div class="departure-main" onclick="selectDeparture('${time}')">
                                          <div class="departure-time">
                                              <div class="time-icon">üïê</div>
                                              <span class="time-text">${formatDepartureLabel(
                                                time
                                              )}</span>
                                          </div>
                                          ${badge}
                                      </div>
                                      ${buttons}
                                  </div>
                              `;
          })
          .join("");
      }

      // Ile przystank√≥w zaznaczono dla danego odjazdu
      function getSelectedCount(time) {
        const stops = savedSchedules[time] || {};
        return Object.values(stops).filter(Boolean).length;
      }

      // Wybierz odjazd
      function selectDeparture(time) {
        currentDeparture = time;
        selectedStops = { ...(savedSchedules[time] || {}) };

        document.getElementById(
          "selected-time"
        ).textContent = `üìç Kurs ${time}`;
        renderStops();

        document.getElementById("departures-view").classList.add("hidden");
        document.getElementById("stops-view").classList.remove("hidden");
      }

      // Wy≈õwietl przystanki z godzinami
      function renderStops() {
        const list = document.getElementById("stops-list");
        const count = Object.values(selectedStops).filter(Boolean).length;
        const schedule = getCurrentSchedule();
        const stopTimes = schedule[currentDeparture] || {};

        document.getElementById(
          "stops-counter"
        ).textContent = `Zaznacz przystanki (${count} wybrano)`;

        list.innerHTML = busStops
          .filter((stop) => stopTimes[stop] !== undefined) // ‚úÖ tylko przystanki z czasem
          .map((stop) => {
            const isSelected = selectedStops[stop];
            const checkmark = isSelected ? "‚úì" : "";
            const time = stopTimes[stop];

            return `
          <button class="stop-btn ${isSelected ? "selected" : ""}"
                  onclick="toggleStop('${stop}')">
              <div class="stop-left">
                <div class="checkbox">${checkmark}</div>
                <span class="stop-name">${stop}</span>
              </div>
              <span class="stop-time">${time}</span>
          </button>
        `;
          })
          .join("");
      }

      // Zaznacz/odznacz przystanek
      function toggleStop(stop) {
        selectedStops[stop] = !selectedStops[stop];
        renderStops();
      }

      // Zapisz przystanki
      function saveStops() {
        savedSchedules[currentDeparture] = { ...selectedStops };
        localStorage.setItem("busSchedules", JSON.stringify(savedSchedules));
        showDepartures();
      }

      // Wyczy≈õƒá aktualne przystanki
      function clearCurrentStops() {
        if (
          confirm(
            "Czy na pewno chcesz wyczy≈õciƒá wszystkie zaznaczone przystanki?"
          )
        ) {
          busStops.forEach((stop) => {
            selectedStops[stop] = false;
          });
          renderStops();
        }
      }

      // Wyczy≈õƒá zapisane przystanki dla danego odjazdu
      function clearDeparture(event, time) {
        event.stopPropagation();

        if (
          confirm(
            `Czy na pewno chcesz wyczy≈õciƒá przystanki dla kursu o ${time}?`
          )
        ) {
          delete savedSchedules[time];
          localStorage.setItem("busSchedules", JSON.stringify(savedSchedules));
          renderDepartures();
        }
      }

      // Skopiuj listƒô z ekranu odjazd√≥w
      function copyDepartureList(event, time) {
        event.stopPropagation();

        const stops = savedSchedules[time] || {};
        const selected = busStops.filter((stop) => stops[stop]);

        if (selected.length === 0) {
          return;
        }

        const schedule = getCurrentSchedule();
        const stopTimes = schedule[time] || {};

        const text = `Lista przystank√≥w na kurs o godzinie ${time}:\n\n${selected
          .map((stop, i) => `${i + 1}. ${stop} - ${stopTimes[stop] || "--:--"}`)
          .join("\n")}`;

        const copyBtn = event.target;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            const originalText = copyBtn.textContent;
            copyBtn.textContent = "‚úì Skopiowano";
            copyBtn.classList.add("copied");

            setTimeout(() => {
              copyBtn.textContent = originalText;
              copyBtn.classList.remove("copied");
            }, 2000);
          })
          .catch(() => {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);

            const originalText = copyBtn.textContent;
            copyBtn.textContent = "‚úì Skopiowano";
            copyBtn.classList.add("copied");

            setTimeout(() => {
              copyBtn.textContent = originalText;
              copyBtn.classList.remove("copied");
            }, 2000);
          });
      }

      // Wy≈õlij SMS
      function sendSMS() {
        const selected = busStops.filter((stop) => selectedStops[stop]);

        if (selected.length === 0) {
          alert("Nie zaznaczono ≈ºadnych przystank√≥w!");
          return;
        }

        const schedule = getCurrentSchedule();
        const stopTimes = schedule[currentDeparture] || {};

        const text = `Lista przystank√≥w na kurs o godzinie ${currentDeparture}:\n\n${selected
          .map((stop, i) => `${i + 1}. ${stop} - ${stopTimes[stop] || "--:--"}`)
          .join("\n")}`;

        const encodedText = encodeURIComponent(text);
        const smsURL = `sms:${driverPhone}?body=${encodedText}`;
        window.location.href = smsURL;
      }

      // Skopiuj listƒô do schowka
      function copyToClipboard() {
        const selected = busStops.filter((stop) => selectedStops[stop]);

        if (selected.length === 0) {
          alert("Nie zaznaczono ≈ºadnych przystank√≥w!");
          return;
        }

        const schedule = getCurrentSchedule();
        const stopTimes = schedule[currentDeparture] || {};

        const text = `Lista przystank√≥w na kurs o godzinie ${currentDeparture}:\n\n${selected
          .map((stop, i) => `${i + 1}. ${stop} - ${stopTimes[stop] || "--:--"}`)
          .join("\n")}`;

        const btn = document.getElementById("copy-btn-stops");

        navigator.clipboard
          .writeText(text)
          .then(() => {
            const originalText = btn.textContent;
            btn.textContent = "‚úì Skopiowano!";
            btn.classList.add("copied");

            setTimeout(() => {
              btn.textContent = originalText;
              btn.classList.remove("copied");
            }, 2000);
          })
          .catch(() => {
            const textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);

            const originalText = btn.textContent;
            btn.textContent = "‚úì Skopiowano!";
            btn.classList.add("copied");

            setTimeout(() => {
              btn.textContent = originalText;
              btn.classList.remove("copied");
            }, 2000);
          });
      }

      // Powr√≥t do listy odjazd√≥w
      function showDepartures() {
        document.getElementById("stops-view").classList.add("hidden");
        document.getElementById("settings-view").classList.add("hidden");
        document.getElementById("departures-view").classList.remove("hidden");
        renderDepartures();
      }

      // ===== AUTOMATYCZNE CZYSZCZENIE DANYCH O 19:25 =====
      function clearDataAtEndOfDay() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();

        if (hours === 19 && minutes === 25) {
          localStorage.removeItem("busSchedules");
          savedSchedules = {};
          selectedStops = {};
          renderDepartures();
          console.log("‚úÖ Lokalna pamiƒôƒá zosta≈Ça wyczyszczona o 19:25");
          alert("üîÑ Dane zosta≈Çy automatycznie wyczyszczone o 19:25");
        }
      }

      // Sprawdzaj co minutƒô
      setInterval(clearDataAtEndOfDay, 60 * 1000);

      // ===== SERVICE WORKER =====
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/sw.js")
          .then(() => console.log("‚úÖ Service Worker zarejestrowany"))
          .catch((err) => console.log("‚ùå Service Worker b≈ÇƒÖd:", err));
      }

      // Inicjalizacja
      loadData();
      renderDepartures();
    </script>
  </body>
</html>
